# 预设快捷键功能更新说明

## 更新概述

本次更新将原有的亮度/对比度调节快捷键功能替换为预设快捷键功能，用户现在可以：
1. 直接在界面上看到所有预设并点击切换
2. 为每个预设单独设置快捷键
3. 通过快捷键快速切换到指定预设

## 主要改动

### 1. 预设配置文件结构 (config/presets.json)
- 为每个预设添加了 `hotkey` 字段
- 默认包含三个预设：默认、夜间模式、阅读模式
- 每个预设可以设置独立的快捷键

### 2. PresetManager 类 (src/preset_manager.py)
新增方法：
- `set_preset_hotkey(name, hotkey)` - 设置预设的快捷键
- `get_preset_hotkey(name)` - 获取预设的快捷键
- `get_all_hotkeys()` - 获取所有预设的快捷键映射

### 3. 主窗口界面 (src/main_window.py)
**重大改动：**
- 移除了预设下拉框，改为按钮列表显示
- 每个预设显示为一个按钮，当前预设会高亮显示
- 按钮上显示预设名称和对应的快捷键（如果设置了）
- 添加了"设置快捷键"按钮，用于配置预设快捷键
- 移除了原有的"热键设置"按钮

新增方法：
- `update_preset_buttons()` - 更新预设按钮列表
- `on_preset_button_clicked(preset_name)` - 处理预设按钮点击
- `on_preset_hotkey_settings()` - 打开预设快捷键设置对话框

### 4. 热键设置对话框 (src/hotkey_dialog.py)
**完全重写：**
- 类名从 `HotkeyDialog` 改为 `PresetHotkeyDialog`
- 移除了所有旧的快捷键设置（增加/降低亮度、对比度等）
- 改为为每个预设设置快捷键
- 添加了快捷键冲突检测
- 支持为预设留空快捷键

### 5. 主程序 (src/main.py)
**重大改动：**
- `register_hotkeys()` 方法完全重写，只注册预设快捷键
- 移除了 `adjust_brightness()` 和 `adjust_contrast()` 方法
- 移除了 `switch_preset()` 方法
- 新增 `switch_to_preset(preset_name)` 方法，用于切换到指定预设

### 6. 配置文件 (config/default_config.json)
- 移除了整个 `hotkeys` 配置节
- 移除了 `advanced.adjustment_step` 配置项

## 使用说明

### 切换预设
1. **通过界面按钮**：直接点击预设按钮即可切换
2. **通过快捷键**：先设置预设的快捷键，然后按快捷键切换

### 设置预设快捷键
1. 点击"⌨️ 设置快捷键"按钮
2. 在弹出的对话框中，点击要设置的预设的输入框
3. 按下想要的快捷键组合（如 Ctrl+Alt+1）
4. 点击"保存"按钮
5. 重启程序使快捷键生效

### 管理预设
- **保存配置**：点击"💾 保存配置"按钮，输入预设名称
- **删除预设**：先切换到要删除的预设，然后点击"🗑️ 删除预设"按钮

## 界面变化

### 之前
```
配置预设
  当前预设: [下拉框选择]
  [💾 保存配置] [🗑️ 删除预设]

[⚙️ 热键设置] [🔄 恢复默认] [➖ 最小化]
```

### 现在
```
配置预设
  当前预设: 默认
  
  [默认]
  [夜间模式]
  [阅读模式]
  
  [💾 保存配置] [🗑️ 删除预设] [⌨️ 设置快捷键]

[🔄 恢复默认] [➖ 最小化]
```

## 技术细节

### 快捷键注册机制
- 程序启动时读取所有预设的快捷键配置
- 为每个设置了快捷键的预设注册全局热键
- 使用闭包确保每个快捷键正确对应其预设

### 按钮状态管理
- 当前激活的预设按钮会高亮显示（蓝色背景）
- 其他预设按钮显示为灰色背景
- 按钮文本格式：`预设名称 (快捷键)`

### 快捷键冲突检测
- 保存快捷键时会检测是否有重复
- 如果发现冲突，会提示用户并阻止保存
- 确保每个快捷键只对应一个预设

## 兼容性说明

- 旧的配置文件会自动升级，添加 `hotkey` 字段
- 如果用户之前设置了旧的热键，这些配置会被忽略
- 建议用户重新设置预设快捷键

## 注意事项

1. 快捷键设置后需要重启程序才能生效
2. 建议使用 Ctrl+Alt 或 Ctrl+Shift 组合键，避免与系统快捷键冲突
3. 可以为预设留空快捷键，只通过界面按钮切换
4. 删除预设时，其快捷键配置也会一并删除

## 文件清单

修改的文件：
- `config/presets.json` - 添加快捷键字段
- `config/default_config.json` - 移除旧的热键配置
- `src/preset_manager.py` - 添加快捷键管理方法
- `src/main_window.py` - 重构预设界面为按钮列表
- `src/hotkey_dialog.py` - 重写为预设快捷键设置对话框
- `src/main.py` - 重构快捷键注册逻辑

新增文件：
- `PRESET_HOTKEY_UPDATE.md` - 本更新说明文档